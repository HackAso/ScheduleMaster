package hackathon.aso.schedulemaster.activity;import android.content.Intent;import android.os.Bundle;import android.support.v7.app.ActionBarActivity;import android.util.Log;import android.view.Menu;import android.view.View;import android.widget.EditText;import android.widget.ImageButton;import android.widget.Toast;import com.nifty.cloud.mb.LogInCallback;import com.nifty.cloud.mb.NCMBException;import com.nifty.cloud.mb.NCMBUser;import hackathon.aso.schedulemaster.R;import hackathon.aso.schedulemaster.object.User;import static android.view.View.OnClickListener;public class LoginActivity extends ActionBarActivity {    OnClickListener listener = new OnClickListener() {        @Override        public void onClick(View v) {            switch (v.getId()) {                case R.id.ib_login_login:                    //ログイン処理                    EditText etEmail = (EditText) findViewById(R.id.et_email_login);                    String userEmail = etEmail.getText().toString();                    EditText etPass = (EditText) findViewById(R.id.et_pass_login);                    String userPass = etPass.getText().toString();                    if (userEmail == null || userPass == null) {                        Toast.makeText(getApplication(), "IDまたはパスワードが違います", Toast.LENGTH_LONG).show();                        return;                    } else {                        NCMBUser.logInInBackground(userEmail, userPass, new LogInCallback() {                            @Override                            public void done(NCMBUser ncmbUser, NCMBException e) {                                if (e == null) {                                    //ログイン成功                                    //currentUserにログインしているユーザーの情報をセット                                    AbstractActivity.currentUser = new User();                                    AbstractActivity.currentUser.setEmail(ncmbUser.getUsername());                                    AbstractActivity.currentUser.setName(ncmbUser.getString("nickName"));                                    //PUSH受け取り端末登録                                    AbstractActivity.currentUser.install(getApplicationContext());                                    //ログイン成功。HOME画面へ遷移                                    Log.i("状態", AbstractActivity.currentUser.getName() + "(" + AbstractActivity.currentUser.getEmail() + ")でログインしました");                                    Intent intent = new Intent(getApplicationContext(), HomeActivity.class);                                    startActivity(intent);                                } else {                                    Log.i("状態", "ログイン失敗: " + e.getLocalizedMessage());                                    Toast.makeText(getApplication(), "IDまたはパスワードが違います", Toast.LENGTH_LONG).show();                                }                            }                        });                    }                    break;                case R.id.ib_register_login:                    Intent intent = new Intent(getApplicationContext(), RegisterActivity.class);                    startActivity(intent);            }        }    };    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_login);        //ログインボタン作成        ImageButton loginButton = (ImageButton) findViewById(R.id.ib_login_login);        loginButton.setOnClickListener(listener);        //ユーサ新規登録へのリンクボタン作成        ImageButton toRegisterButton = (ImageButton) findViewById(R.id.ib_register_login);        toRegisterButton.setOnClickListener(listener);    }    @Override    public boolean onCreateOptionsMenu(Menu menu) {        return true;    }}